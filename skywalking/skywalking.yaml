apiVersion: v1
kind: ConfigMap
metadata:
  name: skywalking-cm
  namespace: skywalking
data:
  CLUSTER: 'nacos'
  CLUSTER_NACOS_HOST_PORT: '192.168.1.55:8848'
  CORE_GRPC_PORT: '11800'
  CORE_REST_PORT: '12800'
  STORAGE: 'elasticsearch'
  STORAGE_ES_CLUSTER_NODES: '192.168.1.20:30002'
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: oap
  namespace: skywalking  
spec:
  replicas: 1
  selector:
    matchLabels:
      app: oap
      release: skywalking
  template:
    metadata:
      labels:
        app: oap
        release: skywalking
    spec:
      containers:
        - envFrom:
          - prefix: SW_
            configMapRef:
              name: skywalking-cm
          name: oap
          image: apache/skywalking-oap-server:9.1.0
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 11800
              name: grpc
            - containerPort: 12800
              name: rest
          volumeMounts:
            - mountPath: /etc/localtime
              name: volume-localtime
      volumes:
        - hostPath:
            path: /etc/localtime
            type: ''
          name: volume-localtime
---
apiVersion: v1
kind: Service   
metadata:
  name: oap
  namespace: skywalking
  labels:
    service: oap
    app: oap
spec:
  ports:
    - port: 12800
      name: rest
    - port: 11800
      name: grpc
  type: NodePort
  selector:
    app: oap

